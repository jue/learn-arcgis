import{f as t,c9 as x,g as s,fv as j,fx as T,m as F,aO as h,fy as z,aW as f,j as I,dE as M,fL as g,ak as d,g6 as y,h1 as G,aR as k,p as L,g_ as B,k as O,er as C}from"./index-a1640f7c.js";import{a as m,c as D}from"./clusterUtils-03328fb7.js";import{t as b,p as S}from"./FeatureReductionSelection-4e18d128.js";import{D as N}from"./featureLayerUtils-6b6e0c1b.js";import{C as E}from"./LabelClass-124e90a0.js";var w;const J="esri.layers.support.FeatureReductionBinning";let a=w=class extends b{constructor(n){super(n),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(n,i,r){const e=n.filter(o=>o.statisticType!=="avg_angle").map(o=>o.toJSON());M(r,e,i)}readRenderer(n,i,r){var o;const e=(o=i.drawingInfo)==null?void 0:o.renderer;return e?g(e,i,r)??void 0:N(i,r)}clone(){return new w({fields:d(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:d(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:d(this.popupTemplate),renderer:d(this.renderer)})}};t([x({binning:"binning"})],a.prototype,"type",void 0),t([x({geohash:"geohash"})],a.prototype,"binType",void 0),t([s({type:Number,range:{min:1,max:9},json:{write:!0}})],a.prototype,"fixedBinLevel",void 0),t([s({type:[E],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],a.prototype,"labelingInfo",void 0),t([s(j)],a.prototype,"labelsVisible",void 0),t([s({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],a.prototype,"maxScale",void 0),t([s(T)],a.prototype,"popupEnabled",void 0),t([s({type:F,json:{name:"popupInfo",write:!0}})],a.prototype,"popupTemplate",void 0),t([s({type:[m],json:{write:!0}})],a.prototype,"fields",void 0),t([h("fields")],a.prototype,"writeFields",null),t([s({types:z,json:{write:{target:"drawingInfo.renderer"}}})],a.prototype,"renderer",void 0),t([f("renderer",["drawingInfo.renderer"])],a.prototype,"readRenderer",null),a=w=t([I(J)],a);const V=a;var v;const H="esri.layers.support.FeatureReductionCluster";function R(n){var i;return n.type==="simple"&&!((i=n.visualVariables)!=null&&i.length)}let l=v=class extends k{constructor(n){super(n),this.type="cluster",this.clusterRadius=y("80px"),this.clusterMinSize=y("12px"),this.clusterMaxSize=y("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(n,i,r){var o,p;const e=(o=i.drawingInfo)==null?void 0:o.renderer;return(p=e==null?void 0:e.authoringInfo)!=null&&p.isAutoGenerated?null:e?R(e)?null:g(e,i,r)??void 0:N(i,r)}readSymbol(n,i,r){var o,p;const e=(o=i.drawingInfo)==null?void 0:o.renderer;if((p=e==null?void 0:e.authoringInfo)!=null&&p.isAutoGenerated)return null;if(e&&R(e)){const u=g(e,i,r);return u==null?void 0:u.symbol}return null}writeSymbol(n,i,r,e){var p,u;const o=(u=(p=this.renderer)==null?void 0:p.authoringInfo)==null?void 0:u.isAutoGenerated;if(!this.renderer||o){const c=new L({symbol:n});i.drawingInfo={renderer:c.write({},e)}}}writeFields(n,i,r){const e=n.filter(o=>o.statisticType!=="avg_angle").map(o=>o.toJSON());M(r,e,i)}readFields(n,i,r){return n.filter(e=>!e.isAutoGenerated).map(e=>m.fromJSON(e))}clone(){return new v({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:d(this.labelingInfo),labelsVisible:this.labelsVisible,fields:d(this.fields),maxScale:this.maxScale,renderer:d(this.renderer),symbol:d(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:d(this.popupTemplate)})}};t([s({type:["cluster"],readOnly:!0,json:{write:!0}})],l.prototype,"type",void 0),t([s({type:Number,cast:n=>n==="auto"?n:y(n),json:{write:!0}})],l.prototype,"clusterRadius",void 0),t([s({type:Number,cast:y,json:{write:!0}})],l.prototype,"clusterMinSize",void 0),t([s({type:Number,cast:y,json:{write:!0}})],l.prototype,"clusterMaxSize",void 0),t([s({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],l.prototype,"maxScale",void 0),t([s(T)],l.prototype,"popupEnabled",void 0),t([s({type:F,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],l.prototype,"popupTemplate",void 0),t([s({types:z,json:{write:{target:"drawingInfo.renderer"}}})],l.prototype,"renderer",void 0),t([f("renderer",["drawingInfo.renderer"])],l.prototype,"readRenderer",null),t([s({types:G})],l.prototype,"symbol",void 0),t([f("symbol",["drawingInfo.renderer"])],l.prototype,"readSymbol",null),t([h("symbol")],l.prototype,"writeSymbol",null),t([s({type:[E],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],l.prototype,"labelingInfo",void 0),t([s(j)],l.prototype,"labelsVisible",void 0),t([s({type:[m],json:{write:!0}})],l.prototype,"fields",void 0),t([h("fields")],l.prototype,"writeFields",null),t([f("fields")],l.prototype,"readFields",null),l=v=t([I(H)],l);const _=l,$={key:"type",base:b,typeMap:{cluster:_,binning:V}},W={types:{key:"type",base:b,typeMap:{selection:S,cluster:_,binning:V}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:$},"portal-item":{types:$},"web-scene":{types:{key:"type",base:b,typeMap:{selection:S}},name:"layerDefinition.featureReduction",write:{layerContainerTypes:B}}}}},X=n=>{let i=class extends n{constructor(...r){super(...r),this.addHandles(O(()=>this.renderer,()=>{if(this.featureReduction){const e=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",e)}},C))}set featureReduction(r){const e=this._normalizeFeatureReduction(r);this._set("featureReduction",e)}set renderer(r){}_normalizeFeatureReduction(r){var c;if((r==null?void 0:r.type)!=="cluster")return r;const e=r.clone(),o=[new m({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],p=(e.fields??[]).filter(A=>!A.isAutoGenerated);if(r.renderer&&!((c=r.renderer.authoringInfo)!=null&&c.isAutoGenerated))return e.fields=[...o,...p],e;if(r.symbol)return e.fields=[...o,...p],e.renderer=null,e;if(!this.renderer)return r;const u=D(o,this.renderer,r,null,!1);return e.fields=[...o,...p],e.renderer=u,e}};return t([s(W)],i.prototype,"featureReduction",null),i=t([I("esri.layers.mixins.FeatureReductionLayer")],i),i};export{X as c};
